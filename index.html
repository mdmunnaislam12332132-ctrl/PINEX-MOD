<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PINEX MOD | ULTIMATE AI</title>
    <style>
        /* CORE STYLES */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; font-family: 'Courier New', monospace; }
        body { margin: 0; background: #000; overflow: hidden; color: #0f0; }
        
        #game-frame { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: 1; }
        .draggable { position: absolute; z-index: 9999; cursor: move; touch-action: none; }

        /* WIDGET DESIGN */
        #mod-widget {
            top: 150px; right: 20px; width: 220px;
            background: rgba(0, 15, 0, 0.95);
            border: 2px solid #00ff00;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            overflow: hidden;
            display: none; /* Initially Hidden */
            backdrop-filter: blur(5px);
        }

        .header {
            background: linear-gradient(90deg, #002200, #004400);
            padding: 8px; text-align: center; border-bottom: 1px solid #0f0;
            font-weight: bold; letter-spacing: 1px; color: #fff; text-shadow: 0 0 5px #0f0;
        }

        .content { padding: 15px; text-align: center; position: relative; }
        
        /* PREDICTION BOX */
        .pred-box {
            font-size: 40px; font-weight: 900; margin: 10px 0;
            text-shadow: 0 0 15px currentColor;
        }
        .big-txt { color: #ffff00; text-shadow: 0 0 20px #ffff00; }
        .small-txt { color: #00ffff; text-shadow: 0 0 20px #00ffff; }
        .wait-txt { color: #555; font-size: 20px; animation: blink 1s infinite; }

        /* INFO BOXES */
        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 11px; color: #aaa; }
        .val { color: #fff; font-weight: bold; }

        .pattern-show {
            background: #111; padding: 5px; border: 1px solid #333;
            font-size: 10px; color: #00ff00; margin-top: 5px; word-spacing: 3px;
        }

        /* STATUS & WIN/LOSS */
        .status-bar {
            margin-top: 10px; padding: 5px; font-weight: bold; font-size: 13px;
            text-transform: uppercase; border-radius: 4px;
        }
        .st-win { background: #004400; color: #0f0; box-shadow: 0 0 10px #0f0; }
        .st-loss { background: #440000; color: #f00; box-shadow: 0 0 10px #f00; }
        .st-wait { background: #111; color: #777; }

        /* SKULL BUTTON */
        #skull-btn {
            top: 80px; left: 10px; width: 50px; height: 50px;
            background: rgba(0,0,0,0.8); border: 2px solid #0f0; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 24px; cursor: pointer; animation: pulse 2s infinite;
        }

        @keyframes blink { 50% { opacity: 0.5; } }
        @keyframes pulse { 0% { box-shadow: 0 0 5px #0f0; } 50% { box-shadow: 0 0 15px #0f0; } 100% { box-shadow: 0 0 5px #0f0; } }
    </style>
</head>
<body>

    <iframe id="game-frame" src="https://tkclub2.com"></iframe>

    <div id="skull-btn" class="draggable" onclick="toggleMod()">ðŸ’€</div>

    <div id="mod-widget" class="draggable">
        <div class="header">PINEX VIP AI</div>
        
        <div class="content">
            <div class="info-row">
                <span>PERIOD: <b id="p-num" class="val">---</b></span>
                <span>DB: <b style="color:#0f0">LIVE</b></span>
            </div>

            <div id="pred-display" class="pred-box wait-txt">WAIT</div>
            
            <div class="info-row" style="justify-content: center; gap: 10px;">
                <span>MATCHES: <b id="match-count" class="val" style="color:#ff00de">0</b></span>
                <span>ACCURACY: <b id="conf-lvl" class="val">0%</b></span>
            </div>

            <div class="pattern-show" id="pattern-seq">SCANNING DB...</div>

            <div id="win-loss-box" class="status-bar st-wait">STARTING...</div>
        </div>
    </div>

    <script>
        // CONFIG
        const DB_URL = "https://ck-win-36ca8-default-rtdb.firebaseio.com/wingo_records.json";
        
        // STATE
        let lastPeriod = null;
        let prediction = null; // 'BIG' or 'SMALL'
        let winStreak = 0;
        let lossStreak = 0;
        let isProcessing = false;

        // --- CORE ALGORITHM: PATTERN MATCHING ---
        function analyzeData(history) {
            // Convert Object to Array and Sort by Period
            const keys = Object.keys(history).sort();
            const results = keys.map(k => history[k].size); // ["BIG", "SMALL", ...]
            
            // Need at least 20 records to scan effectively
            if (results.length < 20) return { res: "SKIP", conf: 0, pat: "NO DATA", match: 0 };

            // Dynamic Scan: Try 8, then 7, then 6, then 5 length patterns
            let bestPrediction = "SKIP";
            let maxConfidence = 0;
            let foundPattern = "";
            let totalMatches = 0;

            for (let depth = 8; depth >= 5; depth--) {
                const currentPattern = results.slice(-depth); // Last 'depth' items
                const patternStr = JSON.stringify(currentPattern);
                
                let bigNext = 0;
                let smallNext = 0;
                let matches = 0;

                // Scan entire history (excluding the very last active set)
                for (let i = 0; i < results.length - depth - 1; i++) {
                    const slice = results.slice(i, i + depth);
                    if (JSON.stringify(slice) === patternStr) {
                        matches++;
                        const nextVal = results[i + depth];
                        if (nextVal === "BIG") bigNext++;
                        else if (nextVal === "SMALL") smallNext++;
                    }
                }

                // If we found significant matches
                if (matches > 2) {
                    let total = bigNext + smallNext;
                    let confBig = (bigNext / total) * 100;
                    let confSmall = (smallNext / total) * 100;

                    if (Math.abs(confBig - confSmall) > 10) { // Only if clear difference
                        bestPrediction = confBig > confSmall ? "BIG" : "SMALL";
                        maxConfidence = Math.max(confBig, confSmall);
                        foundPattern = currentPattern.map(x => x[0]).join(" "); // "B S B B"
                        totalMatches = matches;
                        break; // Stop loop if we found a good long match
                    }
                }
            }

            return { 
                res: bestPrediction, 
                conf: Math.round(maxConfidence), 
                pat: foundPattern || "NO MATCH", 
                match: totalMatches 
            };
        }

        // --- MAIN LOOP ---
        async function runSystem() {
            try {
                const res = await fetch(DB_URL);
                const data = await res.json();
                if (!data) return;

                const keys = Object.keys(data).sort();
                const latestKey = keys[keys.length - 1];
                const latestData = data[latestKey];
                const currentP = latestData.period;

                // Update Period Display
                document.getElementById('p-num').innerText = currentP.slice(-4);

                // Check for New Period
                if (currentP !== lastPeriod) {
                    
                    // 1. Validate Previous Prediction (Win/Loss Logic)
                    if (lastPeriod && prediction && prediction !== "SKIP") {
                        const actualResult = latestData.size; // BIG/SMALL
                        const wlBox = document.getElementById('win-loss-box');

                        if (actualResult === prediction) {
                            // WIN
                            winStreak++;
                            lossStreak = 0;
                            let txt = winStreak > 3 ? `ðŸ”¥ SUPER WIN ${winStreak} ðŸ”¥` : `WIN ${winStreak}`;
                            wlBox.innerText = txt;
                            wlBox.className = "status-bar st-win";
                        } else {
                            // LOSS
                            lossStreak++;
                            winStreak = 0;
                            wlBox.innerText = `LOSS ${lossStreak}`;
                            wlBox.className = "status-bar st-loss";
                        }
                    }

                    lastPeriod = currentP;
                    
                    // 2. Start Calculating New Signal
                    document.getElementById('pred-display').className = "pred-box wait-txt";
                    document.getElementById('pred-display').innerText = "SCAN...";
                    document.getElementById('pattern-seq').innerText = "ANALYZING DB...";

                    setTimeout(() => {
                        const analysis = analyzeData(data);
                        
                        // Update UI with Result
                        prediction = analysis.res;
                        const pBox = document.getElementById('pred-display');
                        
                        if (prediction === "BIG") {
                            pBox.innerText = "BIG";
                            pBox.className = "pred-box big-txt";
                        } else if (prediction === "SMALL") {
                            pBox.innerText = "SMALL";
                            pBox.className = "pred-box small-txt";
                        } else {
                            pBox.innerText = "SKIP";
                            pBox.className = "pred-box wait-txt";
                        }

                        document.getElementById('conf-lvl').innerText = analysis.conf + "%";
                        document.getElementById('match-count').innerText = analysis.match;
                        document.getElementById('pattern-seq').innerText = "SEQ: " + analysis.pat;

                        // Target Period (Current + 1)
                        document.getElementById('p-num').innerText = (parseInt(currentP.slice(-4)) + 1).toString().padStart(4, '0');

                    }, 2000); // Fake processing delay for realism
                }

            } catch (e) { console.error(e); }
        }

        // --- UI UTILITIES ---
        function toggleMod() {
            const w = document.getElementById('mod-widget');
            w.style.display = (w.style.display === 'none') ? 'block' : 'none';
        }

        // Draggable Logic
        document.querySelectorAll('.draggable').forEach(elm => {
            let isDown = false, offX, offY;
            elm.addEventListener('mousedown', e => { isDown=true; offX=e.clientX-elm.offsetLeft; offY=e.clientY-elm.offsetTop; });
            document.addEventListener('mousemove', e => { if(isDown) { elm.style.left=(e.clientX-offX)+'px'; elm.style.top=(e.clientY-offY)+'px'; }});
            document.addEventListener('mouseup', () => isDown=false);
            
            elm.addEventListener('touchstart', e => { offX=e.touches[0].clientX-elm.offsetLeft; offY=e.touches[0].clientY-elm.offsetTop; }, {passive:true});
            elm.addEventListener('touchmove', e => { elm.style.left=(e.touches[0].clientX-offX)+'px'; elm.style.top=(e.touches[0].clientY-offY)+'px'; }, {passive:true});
        });

        // Start Loop
        setInterval(runSystem, 3000); // Check every 3 seconds
    </script>
</body>
</html>
